# Frequently asked questions about developing/maintaining SHEBANQ-local

## How is SHEBANQ-local organized?

1.  The docker images for shebanq only contain the supporting software, such as EMDROS
    and MariaDB, but not the source code of SHEBANQ and not the data.
1.  The source code of SHEBANQ is in this repo, in directory `src`.
1.  The data of the ETCBC databases is readonly, and stored in compressed form in
    `src/databases`.
1.  The user-contributed data of the global SHEBANQ is stored in the `content`
    directory. This data does not contain sensitive user data: only published
    queries and shared notes, and no email addresses and passwords.
1.  When the local SHEBANQ starts working, it uses the MariaDB image to set up a
    MYSQL database system, into which it imports the ETCBC databases from the 
    compressed sources, and the user databases from the initial content in
    `content`. This database system stores all this data in active form in the
    directory `data/mariadb`, which will be created if necessary, at the top-level
    of your `shebanq-local` repo. This `data` directory is in your `.gitignore` file,
    so it will not be synchronised to GitHub if you are in the position to push
    changes back.
    The import process only works for databases that have not already been imported.
    Every time you start up shebanq, this check willl be done.
1.  The source code files for web2py (`src/web2py-shb.zip`) and shebanq
    (`src/shebanq`) are not the files that are executed by the app. Instead,
    a working version of the source is installed in the `run` directory.
    This directory is not synchronised to GitHub, it is in the `.gitignore` file.
    The installation process takes place if there is not yet an installed source,
    or when the argument `update` is passed to the start up command
    (`./shebanq.sh up update`).
    When installation takes place, none of the files/directories that contain
    dynamic data generated by you (logs etc.), is overwritten.
1.  So all data pertaining to shebanq is in your local `shebanq-local` clone.
1.  When you perform a backup, an SQL export of the user data will be put in
    top-level directory `backup`, which is also in your `.gitginore` file.
1.  When you or any user pulls an update of the `shebanq-local` repo, the `data` and
    `backup` directories are not affected. Only the software and settings are updated.
    If the `dockertag` variable in `.env` is increased, the next start up of your
    local shebanq with will pull a corresponding new version of the `shebanq` docker
    image (only if the `update` parameter is passed.
1.  If you have a working, local shebanq, it will not only be upgraded if you pass
    the `update` parameter explicitly.

## How can I build a new shebanq image and distribute this?

Obviously, this is relevant for developers only.

After you have made changes to shebanq that imply that a new image must be built,
do the following:

*   increase the dockertag in the `.env` file
*   `./shebanq.sh build` to build a new image locally
*   `./shebanq.sh push` to push the image to docker hub so that it is available to
    others.
*   Then push the changes to GitHub.
*   Ask users to (re)start their local shebanq by means of the command
    `./shebanq.sh up update`
